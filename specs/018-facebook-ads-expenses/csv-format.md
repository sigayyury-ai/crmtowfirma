# Формат CSV Facebook Ads

## Структура файла

### Заголовок
```csv
"Название кампании",Валюта,"Сумма затрат (PLN)","Дата начала отчетности","Дата окончания отчетности"
```

### Колонки

1. **Название кампании** (`campaign_name`)
   - Может быть в кавычках или без
   - Может содержать префиксы: "Camp /", "Event /", "Coliving /"
   - Могут быть дубликаты названий (несколько записей с одним названием)
   - Примеры:
     - `spain-march`
     - `"France 2"`
     - `"Camp / NY2026"`
     - `"Event / NY2026"`
     - `coliving-december`

2. **Валюта** (`currency`)
   - Обычно `PLN`
   - Может быть другая валюта (но сумма всегда в PLN)

3. **Сумма затрат (PLN)** (`amount_pln`)
   - Накопительная сумма за весь период отчетности
   - Формат: число с точкой или запятой как разделителем десятичных
   - Пример: `65572.98`, `5336.88`

4. **Дата начала отчетности** (`report_start_date`)
   - Формат: `YYYY-MM-DD`
   - Пример: `2025-01-01`

5. **Дата окончания отчетности** (`report_end_date`)
   - Формат: `YYYY-MM-DD`
   - Пример: `2025-12-31`

## Пример данных

```csv
"Название кампании",Валюта,"Сумма затрат (PLN)","Дата начала отчетности","Дата окончания отчетности"
,PLN,65572.98,2025-01-01,2025-12-31
spain-march,PLN,5336.88,2025-01-01,2025-12-31
"France 2",PLN,5145.32,2025-01-01,2025-12-31
"poland lankova09",PLN,4243.41,2025-01-01,2025-12-31
poland-maj11-17,PLN,4200.04,2025-01-01,2025-12-31
"Camp / Spain singles",PLN,4039.36,2025-01-01,2025-12-31
coliving-december,PLN,3686.72,2025-01-01,2025-12-31
"Camp / NY2026",PLN,3189.86,2025-01-01,2025-12-31
"Event / NY2026",PLN,1149.78,2025-01-01,2025-12-31
```

## Особенности

### Дубликаты названий кампаний

В CSV могут быть несколько записей с одинаковым названием кампании, но разными суммами:

```csv
"poland lankova09",PLN,4243.41,2025-01-01,2025-12-31
"poland lankova09",PLN,747.03,2025-01-01,2025-12-31
"poland lankova09",PLN,63.48,2025-01-01,2025-12-31
```

**Обработка:**
- Каждая запись обрабатывается отдельно
- Уникальность определяется по комбинации: `campaign_name_normalized + report_start_date + report_end_date`
- Если период одинаковый, но сумма разная - это может быть ошибка в данных или разные версии кампании
- Рекомендуется суммировать суммы для одинаковых кампаний с одинаковым периодом

### Пустые названия кампаний

В CSV может быть пустое название кампании (первая строка данных):

```csv
,PLN,65572.98,2025-01-01,2025-12-31
```

**Обработка:**
- Такие записи должны быть пропущены или помечены как "Unnamed Campaign"
- Требуется маппинг вручную

### Префиксы в названиях

Названия могут содержать префиксы:
- `Camp /` - кампании
- `Event /` - события
- `Coliving /` - коливинги

**Обработка:**
- При нормализации префиксы сохраняются
- При маппинге на продукты можно использовать префиксы для автоматического предложения маппинга
- Например: "Camp / NY2026" и "Event / NY2026" могут мапиться на один продукт "NY2026"

## Парсинг CSV

### Алгоритм

1. **Чтение заголовка**
   - Проверка наличия всех необходимых колонок
   - Определение индексов колонок

2. **Парсинг строк данных**
   - Разбор CSV строки с учетом кавычек
   - Извлечение значений колонок
   - Валидация данных

3. **Нормализация названия кампании**
   - Удаление кавычек
   - Приведение к нижнему регистру
   - Удаление лишних пробелов
   - Сохранение оригинального названия

4. **Парсинг дат**
   - Валидация формата `YYYY-MM-DD`
   - Преобразование в объект Date

5. **Парсинг суммы**
   - Удаление пробелов и кавычек
   - Преобразование в число
   - Валидация (должно быть положительное число)

### Обработка ошибок

- Пропуск строк с некорректными данными
- Логирование ошибок для последующего анализа
- Отображение ошибок пользователю после импорта

