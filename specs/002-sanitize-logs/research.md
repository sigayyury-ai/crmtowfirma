# Research: Санкционированное логирование

## Decisions

- **PII Templates**: Email, телефон, ФИО, номера проформ (`CO-PROF \d{1,3}/\d{4}`), токены (`[A-Za-z0-9-_]{20,}`) обозначены как чувствительные данные.
- **Masking Strategy**: Заменяем совпадения на `***masked***`, а номера проформ сокращаем до `CO-PROF *** /YYYY` (год сохраняем).
- **Numeric Values**: Суммы платежей и валюты скрываются диапазоном `~[min-max]` (минимум 2 символа, округление до десятков).
- **Incident Counter**: Каждое срабатывание маскировки регистрируется в памяти и добавляется в отчёт.
- **Report Format**: JSON (по умолчанию) с полями `timestamp`, `maskedValueType`, `originalLength`, `messageId`; экспорт в CSV поддерживается через CLI.

## Rationale

- Маскирование PII предотвращает утечку данных при работе операторов и разработчиков.
- Сохранение года в номере проформы необходимо для связывания с бизнес-отчётами без раскрытия конкретного номера.
- Диапазон сумм позволяет оценивать величину платежей без точных значений.
- Отчёт по инцидентам помогает анализировать источники потенциальных нарушений.

## Alternatives Considered

- Полное удаление логов с PII → отклонено, т.к. снижает наблюдаемость.
- Использование сторонней библиотеки DLP → отклонено, добавляет зависимости и сложность.
- Сохранение оригинальных значений в зашифрованном виде → отклонено из-за требований Secure Credential Stewardship (минимизация хранения секрета).

## Open Questions

- Нужно ли расширить список шаблонов PII для других типов данных (например, паспорт, IBAN)?
- Требуется ли хранить историю инцидентов между сессиями (пока нет, обсуждается с безопасностью).
