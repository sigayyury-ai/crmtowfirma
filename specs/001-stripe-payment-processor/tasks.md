# Tasks: Stripe Payment Processor

**Input**: Design documents from `/specs/001-stripe-payment-processor/`  
**Prerequisites**: plan.md, spec.md, research.md, data-model.md, contracts/, quickstart.md

**Tests**: –°–º. research.md ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º smoke-—Å–∫—Ä–∏–ø—Ç—ã –∏ —Ä—É—á–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏; –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è.

**Organization**: –ó–∞–¥–∞—á–∏ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã –ø–æ user story, –∫–∞–∂–¥–∞—è –∏—Å—Ç–æ—Ä–∏—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞ –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–∞ –æ—Ç–¥–µ–ª—å–Ω–æ.

## Phase 1: Setup (Shared Infrastructure)

**Purpose**: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞.

- [X] T001 –û–±–Ω–æ–≤–∏—Ç—å `.env.example` —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ Stripe (`STRIPE_API_KEY`, `STRIPE_EVENTS_CACHE_TTL_MS`) –≤ `/Users/urok/Comoon/pipedrive-wfirma-integration/env.example`
- [X] T002 –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–æ–≤–æ–º—É —Ä–µ–∂–∏–º—É –≤ `README.md` –∏–ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ä–∞–∑–¥–µ–ª –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (–µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî —Å–æ–∑–¥–∞—Ç—å) –≤ `/Users/urok/Comoon/pipedrive-wfirma-integration/README.md`
- [X] T003 –ù–∞—Å—Ç—Ä–æ–∏—Ç—å npm-—Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ Stripe –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `runStripeProcessor`) –≤ `/Users/urok/Comoon/pipedrive-wfirma-integration/package.json`
- [X] T004 –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Stripe health-check –º–∞—Ä—à—Ä—É—Ç–∞ –≤ `src/routes/api.js` (—É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `/api/stripe-health` –ø–æ–¥–∫–ª—é—á—ë–Ω –≤ —Ä–µ–∂–∏–º–µ dev/test)

---

## Phase 2: Foundational (Blocking Prerequisites)

**Purpose**: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞—è –≤—Å–µ–º –∏—Å—Ç–æ—Ä–∏—è–º.

- [X] T005 –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Stripe client singleton —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π test/live –∫–ª—é—á–µ–π –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º (`src/services/stripe/client.js`)
- [X] T006 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å –æ–±–º–µ–Ω–∞ –∫—É—Ä—Å–∞–º–∏ –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é (`src/services/stripe/exchangeRateService.js`, `src/utils/currency.js`) —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ fallback –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º
- [X] T007 –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏/DAO –¥–ª—è –∑–∞–ø–∏—Å–∏ –ø–ª–∞—Ç–µ–∂–µ–π, –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, product link –∏ deletion log (—Ä–∞—Å—à–∏—Ä–∏—Ç—å `src/services/invoiceProcessing.js` –∏–ª–∏ –≤—ã–Ω–µ—Å—Ç–∏ –≤ `src/services/stripe/service.js`)
- [X] T008 [P] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å middleware `requireStripeAccess` –¥–ª—è –∑–∞—â–∏—Ç—ã –Ω–æ–≤—ã—Ö API –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –æ–Ω –ø—Ä–∏–º–µ–Ω—ë–Ω –∫ Stripe –º–∞—Ä—à—Ä—É—Ç–∞–º (`src/middleware/auth.js`, `src/routes/api.js`)
- [X] T009 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π scheduler/trigger —Ö—É–∫ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ (–∞–¥–∞–ø—Ç–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∑–∞–ø—É—Å–∫–∞ proforma) –≤ `src/services/invoiceProcessing.js` –∏–ª–∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–º –º–æ–¥—É–ª–µ
- [X] T010 –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ runId –¥–ª—è Stripe (`src/utils/logging/stripe.js`, `src/services/stripe/processor.js`)

---

## Phase 3: User Story 1 - –ó–∞–ø—É—Å–∫ Stripe-–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ —Ä–∞—Å—á—ë—Ç–æ–≤ (Priority: P1) üéØ MVP

**Goal**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç Stripe Checkout Sessions, –∑–∞–ø–∏—Å—å –≤ –ë–î, —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ –∏ —Ä—É—á–Ω–æ–π —Ç—Ä–∏–≥–≥–µ—Ä.

**Independent Test**: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä (manual/test mode), —É–≤–∏–¥–µ—Ç—å, —á—Ç–æ Stripe —Å–µ—Å—Å–∏–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è, –∑–∞–ø–∏—Å–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ –ë–î –∏ –ª–æ–≥ runId —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏.

### Implementation

- [X] T011 [US1] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å `stripeProcessorService` –¥–ª—è –≤—ã–±–æ—Ä–∫–∏ Checkout Sessions, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π, ProductLink –∏ –∂—É—Ä–Ω–∞–ª–∞ –∑–∞–ø—É—Å–∫–æ–≤ (`src/services/stripe/processor.js`, `src/services/stripe/service.js`)
- [X] T012 [US1] –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ Supabase —á–µ—Ä–µ–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (`src/services/stripe/processor.js`, `src/services/stripe/repository.js`)
- [X] T013 [US1] –í–∫–ª—é—á–∏—Ç—å –∑–∞–ø–∏—Å—å `PaymentProcessorRun` –∏ —Å—Ç–∞—Ç—É—Å–Ω—ã—Ö –ª–æ–≥–æ–≤ (`src/services/stripe/processor.js`, `src/services/scheduler.js`)
- [X] T014 [US1] –î–æ–±–∞–≤–∏—Ç—å —Ä—É—á–Ω–æ–π endpoint/—Å–∫—Ä–∏–ø—Ç `node scripts/runStripeProcessor.js --mode test` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ (`scripts/runStripeProcessor.js`, `package.json`, `src/routes/stripe.js`)
- [X] T015 [US1] –û–±–Ω–æ–≤–∏—Ç—å `/api/stripe/processors/runs` –≤ `src/routes/stripe.js` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (`since`, `until`, —Ä–µ–∂–∏–º test) –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ runId
- [X] T016 [US1] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ frontend health-check –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ Stripe (–¥–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞ VAT Margin –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏) ‚Äî `frontend/vat-margin-script.js`

**Checkpoint**: –ú–æ–∂–Ω–æ –Ω–∞–∑–≤–∞—Ç—å MVP –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–º –∫–∞–∫ —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã–π —Ü–∏–∫–ª ¬´—Ç—Ä–∏–≥–≥–µ—Ä ‚Üí Stripe –ø–ª–∞—Ç—ë–∂ ‚Üí –∏–º–ø–æ—Ä—Ç¬ª –ø—Ä–æ—Ö–æ–¥–∏—Ç.

---

## Phase 4: User Story 2 - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º (Priority: P2)

**Goal**: –û–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–µ –æ—Ç—á—ë—Ç—ã, —Å—É–º–º–∏—Ä—É—é—â–∏–µ ProForm + Stripe –¥–∞–Ω–Ω—ã–µ, —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π –≤ PLN –∏ —ç–∫—Å–ø–æ—Ä—Ç–æ–º.

**Independent Test**: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–µ—Å—è—á–Ω—ã–π –∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã–π –æ—Ç—á—ë—Ç; —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å—É–º–º—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å Stripe Dashboard –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —ç–∫—Å–ø–æ—Ä—Ç–µ.

- [X] T017 [US2] –†–∞—Å—à–∏—Ä–∏—Ç—å backend-–∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–ª—è –º–µ—Å—è—á–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `src/services/invoiceProcessing.js` –∏–ª–∏ –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å `src/services/stripe/analyticsService.js`)
- [X] T018 [US2] –û–±–Ω–æ–≤–∏—Ç—å API `/api/reports/stripe-events/summary` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞ `month`, –≤–∞–ª—é—Ç –∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–π (`src/routes/stripeEventReport.js`)
- [X] T019 [US2] –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ `frontend/vat-margin-script.js` –∏ `vat-margin.html` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤, –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
- [X] T020 [US2] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç CSV (`/api/reports/stripe-events/{eventKey}/export`) —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ –∏ —Å—É–º–º—ã PLN (`src/services/stripe/eventReportService.js`)
- [X] T021 [US2] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É–¥–∞–ª—ë–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏/–≤–æ–∑–≤—Ä–∞—Ç—ã —Å —Ä–∞–∑–¥–µ–ª–æ–º ¬´–£–¥–∞–ª—ë–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–æ—Ä–º—ã¬ª (Supabase log + –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–æ–≤)

---

## Phase 5: User Story 3 - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Å—Ç–∏—á–Ω—ã–º–∏ –æ–ø–ª–∞—Ç–∞–º–∏ –∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏ —Å–¥–µ–ª–∫–∏ (Priority: P3)

**Goal**: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ –æ–ø–ª–∞—Ç—ã, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–¥–∏–π Pipedrive, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π.

**Independent Test**: –°–æ–∑–¥–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫—É –≤ Stripe –¥–≤–∞ –ø–ª–∞—Ç–µ–∂–∞, —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤ CRM —Å—Ç–∞–¥–∏–∏ —Å–º–µ–Ω–∏–ª–∏—Å—å (stage_id=18 ‚Üí 32 ‚Üí 27), –∞ –∫–∞—Ä—Ç–æ—á–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤—Å–µ –≤–∑–Ω–æ—Å—ã.

- [X] T022 [US3] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ParticipantPaymentPlan –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä (–º–æ–∂–Ω–æ –≤ `src/services/stripe/service.js` –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–º –º–æ–¥—É–ª–µ) —Å –ø–æ–¥—Å—á—ë—Ç–æ–º expected/received payments
- [X] T023 [US3] –î–æ–±–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞–¥–∏–π —Å–¥–µ–ª–∫–∏ —á–µ—Ä–µ–∑ Pipedrive API (`src/services/invoiceProcessing.js` –∏–ª–∏ –Ω–æ–≤—ã–π `src/services/stripe/crmSync.js`)
- [X] T024 [US3] –û–±–Ω–æ–≤–∏—Ç—å API –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞ `/api/reports/stripe-events/:eventKey` –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å–ø–∏—Å–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞/–ø–ª–∞—Ç–µ–∂–µ–π —Å —Ç–∏–ø–∞–º–∏ (`src/routes/stripeEventReport.js`)
- [X] T025 [US3] –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ `frontend/stripe-event-report/script.js` –∏ `index.html`, —á—Ç–æ–±—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –ø–ª–∞—Ç–µ–∂–∏, –∏—Ö —Ç–∏–ø—ã –∏ —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–¥–µ–ª–∫–∏
- [ ] T026 [US3] –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–æ–∑–≤—Ä–∞—Ç—ã –∏ –æ—Ç–∫–∞—Ç—ã —Å—Ç–∞–¥–∏–π (–µ—Å–ª–∏ –ø–æ–ª–∏—Ç–∏–∫–∏ —Ç—Ä–µ–±—É—é—Ç) –≤ —Å–µ—Ä–≤–∏—Å–µ CRM —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- [ ] T031 [US3] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å B2B flow: –ø–æ–¥—Ç—è–≥–∏–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –∞–¥—Ä–µ—Å, NIP) –∏–∑ Pipedrive –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Ö –≤ `StripePayment`/metadata (Processor + Repository)
- [ ] T032 [US3] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å VAT –æ–±—Ä–∞–±–æ—Ç–∫—É: –≤–∫–ª—é—á–∞—Ç—å Stripe Tax –≤ —Ä–µ–∂–∏–º–µ collect/no remit –¥–ª—è —Å–¥–µ–ª–æ–∫ —Å country=PL, —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å—É–º–º—ã VAT –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å Checkout –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞

---

## Phase 6: Polish & Cross-Cutting Concerns

**Purpose**: –§–∏–Ω–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è.

- [ ] T027 [P] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é (`specs/001-stripe-payment-processor/quickstart.md`, `README.md`) —Å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º–∏ —à–∞–≥–∞–º–∏ –∑–∞–ø—É—Å–∫–∞ –∏ —Ç–µ—Å—Ç–æ–≤
- [ ] T028 [P] –ü—Ä–æ–≤–µ—Å—Ç–∏ smoke-–ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ `quickstart` (setup ‚Üí health check ‚Üí test trigger ‚Üí –æ—Ç—á—ë—Ç) –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- [ ] T029 –ü—Ä–æ–≤–µ—Å—Ç–∏ –∫–æ–¥-—Ä–µ–≤—å—é –∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –æ–±—â–µ–≥–æ –∫–æ–¥–∞ (`src/services/stripe/*`, `src/services/invoiceProcessing.js`) –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
- [ ] T030 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Render/CI (–µ—Å–ª–∏ –µ—Å—Ç—å) –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –Ω–æ–≤—ã—Ö env vars –∏ deploy hook

---

## Dependencies & Execution Order

- Setup (Phase 1) ‚Üí Foundational (Phase 2) ‚Üí User Stories (Phase 3‚Äì5) ‚Üí Polish (Phase 6).
- User Story —Ñ–∞–∑—ã –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Phase 2, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫: US1 ‚Üí US2 ‚Üí US3.
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–º–µ—á–µ–Ω—ã `[P]`.

---

## Parallel Execution Examples

- **Foundational**: T008 (middleware) –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å T010 (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ), —Ç.–∫. –æ–Ω–∏ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç —Ä–∞–∑–Ω—ã–µ —Ñ–∞–π–ª—ã.
- **US1**: T011 (—Å–µ—Ä–≤–∏—Å –∏–º–ø–æ—Ä—Ç–∞) –∏ T015 (endpoint) –ø–æ–∫–∞ –Ω–µ –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞, —Ç–∞–∫ —á—Ç–æ —á–∞—Å—Ç—å –∫–æ–º–∞–Ω–¥—ã –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ API, –¥—Ä—É–≥–∞—è ‚Äî –Ω–∞–¥ —Å–µ—Ä–≤–∏—Å–æ–º.
- **US2**: T018 (API summary) –∏ T019 (frontend) –º–æ–∂–Ω–æ –≤–µ—Å—Ç–∏ –≤ —Å–≤—è–∑–∫–µ, –Ω–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ mocks —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –º–æ–∂–Ω–æ –ø–∞—Ä–∞–ª–ª–µ–ª–∏—Ç—å.
- **US3**: T023 (CRM –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ) –∏ T024 (–¥–µ—Ç–∞–ª—å–Ω—ã–π API) –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å–ª–æ—è—Ö, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ–ª–∏—Ç—å —Ä–∞–±–æ—Ç—É.

---

## Implementation Strategy

- **MVP**: –∑–∞–≤–µ—Ä—à–∏—Ç—å Phases 1‚Äì3, –ø–æ–ª—É—á–∏—Ç—å —Ä–∞–±–æ—á–∏–π —Ç–µ—Å—Ç–æ–≤—ã–π flow.  
- **Incremental Delivery**: –ø–æ—Å–ª–µ MVP –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç—á—ë—Ç—ã (Phase 4), –∑–∞—Ç–µ–º —á–∞—Å—Ç–∏—á–Ω—ã–µ –æ–ø–ª–∞—Ç—ã/CRM (Phase 5).  
- **Testing**: –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã –∑–∞–ø—É—Å–∫–∞—Ç—å smoke-—Å–∫—Ä–∏–ø—Ç –∏–∑ quickstart: health check ‚Üí test trigger ‚Üí –æ—Ç—á—ë—Ç ‚Üí rollback/refund.

---

## Task Statistics

- Total tasks: 30  
- User Story 1 tasks: 6  
- User Story 2 tasks: 5  
- User Story 3 tasks: 5  
- Parallel opportunities: T003, T008, T010, T027, T028  
- Independent test criteria: –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–π user story (—Å–º. –æ–ø–∏—Å–∞–Ω–∏—è —Ñ–∞–∑)  
- Suggested MVP: Phase 3 (User Story 1)

