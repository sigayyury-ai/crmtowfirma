# Конфигурация банковских счетов

## Описание

Этот файл содержит конфигурацию для сопоставления валют из Pipedrive CRM с банковскими счетами в системе wFirma.

## Структура конфигурации

### BANK_ACCOUNT_CONFIG

Основная конфигурация банковских счетов по валютам:

```javascript
{
  PLN: {
    name: 'PL / konto firmowe - 2693', // Название счета в wFirma
    fallback: 'M bank zl',             // Fallback если не найдем по названию
    description: 'Основной счет в польских злотых'
  },
  EUR: {
    name: 'EUR / konto firmowe - 2801', // Название счета в wFirma
    fallback: 'M Bank EUR',             // Fallback если не найдем по названию
    description: 'Счет в евро для международных операций'
  }
}
```

### SUPPORTED_CURRENCIES

Массив поддерживаемых валют:
```javascript
['PLN', 'EUR', 'USD']
```

## Как изменить настройки

### 1. Добавление новой валюты

1. Добавьте новую валюту в `SUPPORTED_CURRENCIES`
2. Добавьте конфигурацию в `BANK_ACCOUNT_CONFIG`:

```javascript
GBP: {
  name: 'GBP Account Name', // Название счета в wFirma
  fallback: 'GBP Fallback', // Fallback если не найдем по названию
  description: 'Счет в британских фунтах'
}
```

### 2. Изменение существующего счета

1. Найдите нужную валюту в `BANK_ACCOUNT_CONFIG`
2. Обновите поле `name` согласно данным из wFirma
3. При необходимости обновите `fallback` значение

### 3. Получение названий счетов из wFirma

Для получения актуальных названий счетов:

1. Запустите тест: `node test-bank-accounts.js`
2. Скопируйте названия счетов из вывода
3. Обновите конфигурацию

## Логика поиска счетов

Система использует следующую логику для поиска банковского счета:

1. **Точное совпадение**: Поиск по точному названию из конфигурации
2. **Частичное совпадение**: Поиск по первому слову названия
3. **По валюте**: Если не найдено по названию, поиск по валюте
4. **Fallback**: Использование fallback значения из конфигурации

## Примеры использования

### Тестирование конфигурации

```bash
# Тест получения банковских счетов
node test-bank-accounts.js

# Тест создания Proforma с динамическими счетами
node test-proforma-with-dynamic-banks.js
```

### API endpoints

```bash
# Получить статус системы
GET /api/invoice-processing/status

# Создать Proforma для конкретной сделки
POST /api/invoice-processing/deal/1516
```

## Устранение неполадок

### Ошибка "No bank account configuration for currency"

- Проверьте, что валюта добавлена в `SUPPORTED_CURRENCIES`
- Убедитесь, что есть конфигурация в `BANK_ACCOUNT_CONFIG`

### Ошибка "Bank account not found"

- Проверьте название счета в wFirma
- Обновите поле `name` в конфигурации
- Проверьте fallback значение

### Неправильный счет используется

- Проверьте логику поиска в методе `getBankAccountByCurrency`
- Убедитесь, что названия счетов в wFirma соответствуют конфигурации




