<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PNL –û—Ç—á–µ—Ç - Pipedrive ‚Üî wFirma</title>
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
    <meta name="googlebot" content="noindex, nofollow, noarchive, nosnippet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container pnl-container-fullwidth">
        <nav class="main-nav">
            <a href="/vat-margin.html" class="nav-link">–û—Ç—á–µ—Ç—ã</a>
            <a href="/pnl-report.html" class="nav-link active">PNL –û—Ç—á–µ—Ç</a>
            <a href="/" class="nav-link">–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</a>
        </nav>
        <header>
            <h1>üìä PNL –û—Ç—á–µ—Ç</h1>
            <p>–ú–µ—Å—è—á–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—ã –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ (–±–µ–∑ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤)</p>
        </header>

        <!-- Tabs Navigation -->
        <div class="tab-container">
            <div class="tab-header">
                <button class="tab-button active" data-tab="report">–û—Ç—á–µ—Ç</button>
                <button class="tab-button" data-tab="expenses">–†–∞—Å—Ö–æ–¥—ã</button>
                <button class="tab-button" data-tab="settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            </div>
        </div>

        <!-- Report Tab -->
        <div class="tab-content active" id="tab-report">
        <div class="pnl-report-section">
            <div class="section-header">
                <h2>–ú–µ—Å—è—á–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—ã</h2>
                <div class="controls">
                    <div class="year-selector-group">
                        <label for="year-select" class="year-label">–ì–æ–¥:</label>
                        <select id="year-select" class="year-select" aria-label="–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–¥ –¥–ª—è –æ—Ç—á–µ—Ç–∞">
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                            <option value="2028">2028</option>
                        </select>
                    </div>
                    <button id="refresh-pnl" class="btn btn-primary">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
            </div>

            <div id="pnl-loading" class="loading-indicator" style="display: none;" role="status" aria-live="polite">
                <span class="sr-only">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
                –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
            </div>

            <div id="pnl-error" class="error-message" style="display: none;" role="alert" aria-live="assertive"></div>

            <div id="pnl-report-container">
                <div class="placeholder">–ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö...</div>
            </div>
        </div>
        </div>

        <!-- Expenses Tab -->
        <div class="tab-content" id="tab-expenses" style="padding: 0; margin: 0;">
            <iframe src="expenses.html" style="width: 100%; height: calc(100vh - 200px); border: none; background: transparent;"></iframe>
        </div>

        <!-- Settings Tab -->
        <div class="tab-content" id="tab-settings">
            <div class="pnl-settings-section">
                <div class="section-header">
                    <h2>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</h2>
                    <div class="controls">
                        <label class="upload-btn">
                            <input type="file" id="expenses-csv-input" accept=".csv" hidden>
                            üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å CSV (—Ä–∞—Å—Ö–æ–¥—ã)
                        </label>
                        <button id="add-expense-category-btn" class="btn btn-primary">+ –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                    </div>
                </div>

                <div id="expense-categories-loading" class="loading-indicator" style="display: none;" role="status" aria-live="polite">
                    <span class="sr-only">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞—Å—Ö–æ–¥–æ–≤...</span>
                    –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞—Å—Ö–æ–¥–æ–≤...
                </div>

                <div id="expense-categories-error" class="error-message" style="display: none;" role="alert" aria-live="assertive"></div>

                <div id="expense-categories-container">
                    <div class="placeholder">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞—Å—Ö–æ–¥–æ–≤...</div>
                </div>
            </div>

            <div class="pnl-settings-section" style="margin-top: 40px;">
                <div class="section-header">
                    <h2>–ü—Ä–∞–≤–∏–ª–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</h2>
                    <button id="add-mapping-btn" class="btn btn-primary">+ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ</button>
                </div>

                <div id="mappings-loading" class="loading-indicator" style="display: none;" role="status" aria-live="polite">
                    <span class="sr-only">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–≤–∏–ª...</span>
                    –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–≤–∏–ª...
                </div>

                <div id="mappings-error" class="error-message" style="display: none;" role="alert" aria-live="assertive"></div>

                <div id="mappings-container">
                    <div class="placeholder">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–≤–∏–ª –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏...</div>
                </div>
            </div>

            <div class="pnl-settings-section" style="margin-top: 40px;">
                <div class="section-header">
                    <h2>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏—Ö–æ–¥–æ–≤</h2>
                    <button id="add-category-btn" class="btn btn-primary">+ –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                </div>

                <div id="categories-loading" class="loading-indicator" style="display: none;" role="status" aria-live="polite">
                    <span class="sr-only">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...</span>
                    –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...
                </div>

                <div id="categories-error" class="error-message" style="display: none;" role="alert" aria-live="assertive"></div>

                <div id="categories-container">
                    <div class="placeholder">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...</div>
                </div>
            </div>
        </div>

        <div class="logs-section">
            <div class="section-header">
                <h2>üìù –õ–æ–≥–∏</h2>
                <button id="clear-logs" class="btn btn-link">–û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
            <div id="logs-container" class="logs-container">
                <div class="log-entry info">–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ</div>
            </div>
        </div>
    </div>

    <!-- Modal for uncategorized expenses with suggestions -->
    <div id="expense-suggestions-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>–†–∞—Å—Ö–æ–¥—ã –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
                <button class="modal-close" onclick="closeExpenseSuggestionsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p id="expense-suggestions-summary"></p>
                <div id="expense-suggestions-list" style="max-height: 600px; overflow-y: auto; margin-top: 20px;">
                    <!-- Suggestions will be rendered here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeExpenseSuggestionsModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <script src="pnl-report-script.js"></script>
</body>
</html>

