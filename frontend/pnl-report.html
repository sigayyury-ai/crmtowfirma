<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PNL –û—Ç—á–µ—Ç - Pipedrive ‚Üî wFirma</title>
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
    <meta name="googlebot" content="noindex, nofollow, noarchive, nosnippet">
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="container pnl-container-fullwidth">
        <nav class="main-nav">
            <a href="/vat-margin.html" class="nav-link">–û—Ç—á–µ—Ç—ã</a>
            <a href="/pnl-report.html" class="nav-link active">PNL –û—Ç—á–µ—Ç</a>
            <a href="/analytics/mql-report.html" class="nav-link">Marketing</a>
            <a href="/" class="nav-link">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
        </nav>
        <!-- Tabs Navigation -->
        <div class="tab-container">
            <div class="tab-header">
                <button class="tab-button active" data-tab="report">–û—Ç—á–µ—Ç</button>
                <button class="tab-button" data-tab="insights">–í—ã–≤–æ–¥—ã</button>
                <button class="tab-button" data-tab="settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            </div>
        </div>

        <!-- Report Tab -->
        <div class="tab-content active" id="tab-report">
        <div class="pnl-report-section">
            <div class="section-header">
                <h2>–ú–µ—Å—è—á–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—ã</h2>
                <div class="controls">
                    <div class="year-selector-group">
                        <label for="year-select" class="year-label">–ì–æ–¥:</label>
                        <select id="year-select" class="year-select" aria-label="–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–¥ –¥–ª—è –æ—Ç—á–µ—Ç–∞">
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                            <option value="2028">2028</option>
                        </select>
                    </div>
                    <button id="refresh-pnl" class="btn btn-primary">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                    <button id="check-duplicates-btn" class="btn btn-secondary">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—É–±–ª–∏</button>
                </div>
            </div>

            <div id="pnl-loading" class="loading-indicator" style="display: none;" role="status" aria-live="polite">
                <span class="sr-only">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
                –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
            </div>

            <div id="pnl-error" class="error-message" style="display: none;" role="alert" aria-live="assertive"></div>

            <div id="pnl-report-container">
                <div class="placeholder">–ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö...</div>
            </div>
        </div>
        </div>

        <!-- Insights Tab -->
        <div class="tab-content" id="tab-insights">
            <div class="pnl-report-section">
                <div class="section-header">
                    <h2>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–≤–æ–¥—ã</h2>
                    <div class="controls">
                        <div class="year-selector-group">
                            <label for="insights-year-select" class="year-label">–ì–æ–¥:</label>
                            <select id="insights-year-select" class="year-select" aria-label="–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–¥ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏">
                                <option value="2024">2024</option>
                                <option value="2025">2025</option>
                                <option value="2026">2026</option>
                                <option value="2027">2027</option>
                                <option value="2028">2028</option>
                            </select>
                        </div>
                        <button id="regenerate-ai-insights-btn" class="btn btn-secondary" style="margin-left: 20px;" title="–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å AI-–≤—ã–≤–æ–¥—ã">
                            üîÑ –û–±–Ω–æ–≤–∏—Ç—å –≤—ã–≤–æ–¥—ã
                        </button>
                    </div>
                </div>

                <!-- Insights Sub-tabs -->
                <div class="sub-nav" style="margin-top: 20px; margin-bottom: 20px;">
                    <button class="subtab-button active" data-subtab="overview">–û–±–∑–æ—Ä</button>
                    <button class="subtab-button" data-subtab="comparison">–°—Ä–∞–≤–Ω–µ–Ω–∏—è</button>
                    <button class="subtab-button" data-subtab="operations">–û–ø–µ—Ä–∞—Ü–∏–∏</button>
                    <button class="subtab-button" data-subtab="trends">–¢—Ä–µ–Ω–¥—ã</button>
                    <button class="subtab-button" data-subtab="strategic">–í—ã–≤–æ–¥—ã</button>
                </div>

                <div id="insights-loading" class="loading-indicator" style="display: none;" role="status" aria-live="polite">
                    <span class="sr-only">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö...</span>
                    –ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö...
                </div>

                <div id="insights-error" class="error-message" style="display: none;" role="alert" aria-live="assertive"></div>

                <!-- Overview Sub-tab -->
                <div class="insights-subtab-content active" id="insights-overview">
                    <div class="placeholder">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–¥ –∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö...</div>
                </div>

                <!-- Comparison Sub-tab -->
                <div class="insights-subtab-content" id="insights-comparison">
                    <div class="placeholder">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–¥ –∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö...</div>
                </div>

                <!-- Operations Sub-tab -->
                <div class="insights-subtab-content" id="insights-operations">
                    <div class="placeholder">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–¥ –∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö...</div>
                </div>

                <!-- Trends Sub-tab -->
                <div class="insights-subtab-content" id="insights-trends">
                    <div class="placeholder">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–¥ –∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö...</div>
                </div>

                <!-- Strategic Insights Sub-tab -->
                <div class="insights-subtab-content" id="insights-strategic">
                    <div class="placeholder">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–¥ –∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö...</div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div class="tab-content" id="tab-settings">
            <div class="pnl-settings-section">
                <div class="section-header">
                    <h2>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</h2>
                    <div class="controls">
                        <label class="upload-btn">
                            <input type="file" id="expenses-csv-input" accept=".csv" hidden>
                            üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å CSV (—Ä–∞—Å—Ö–æ–¥—ã)
                        </label>
                        <button id="add-expense-category-btn" class="btn btn-primary">+ –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                    </div>
                </div>

                <div id="expense-categories-loading" class="loading-indicator" style="display: none;" role="status" aria-live="polite">
                    <span class="sr-only">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞—Å—Ö–æ–¥–æ–≤...</span>
                    –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞—Å—Ö–æ–¥–æ–≤...
                </div>

                <div id="expense-categories-error" class="error-message" style="display: none;" role="alert" aria-live="assertive"></div>

                <div id="expense-categories-container">
                    <div class="placeholder">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞—Å—Ö–æ–¥–æ–≤...</div>
                </div>
            </div>

            <div class="pnl-settings-section" style="margin-top: 40px;">
                <div class="section-header">
                    <h2>–ü—Ä–∞–≤–∏–ª–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</h2>
                    <button id="add-mapping-btn" class="btn btn-primary">+ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ</button>
                </div>

                <div id="mappings-loading" class="loading-indicator" style="display: none;" role="status" aria-live="polite">
                    <span class="sr-only">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–≤–∏–ª...</span>
                    –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–≤–∏–ª...
                </div>

                <div id="mappings-error" class="error-message" style="display: none;" role="alert" aria-live="assertive"></div>

                <div id="mappings-container">
                    <div class="placeholder">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–≤–∏–ª –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏...</div>
                </div>
            </div>

            <div class="pnl-settings-section" style="margin-top: 40px;">
                <div class="section-header">
                    <h2>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏—Ö–æ–¥–æ–≤</h2>
                    <button id="add-category-btn" class="btn btn-primary">+ –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                </div>

                <div id="categories-loading" class="loading-indicator" style="display: none;" role="status" aria-live="polite">
                    <span class="sr-only">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...</span>
                    –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...
                </div>

                <div id="categories-error" class="error-message" style="display: none;" role="alert" aria-live="assertive"></div>

                <div id="categories-container">
                    <div class="placeholder">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...</div>
                </div>
            </div>
        </div>

        <div class="logs-section">
            <div class="section-header">
                <h2>üìù –õ–æ–≥–∏</h2>
                <button id="clear-logs" class="btn btn-link">–û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
            <div id="logs-container" class="logs-container">
                <div class="log-entry info">–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ</div>
            </div>
        </div>
    </div>

    <!-- Modal for uncategorized expenses with suggestions -->
    <div id="expense-suggestions-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>–†–∞—Å—Ö–æ–¥—ã –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
                <button class="modal-close" onclick="closeExpenseSuggestionsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p id="expense-suggestions-summary"></p>
                <div id="expense-suggestions-list" style="max-height: 600px; overflow-y: auto; margin-top: 20px;">
                    <!-- Suggestions will be rendered here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeExpenseSuggestionsModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Modal for adding manual cash expense entry -->
    <div id="add-expense-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 id="add-entry-title">–î–æ–±–∞–≤–∏—Ç—å</h3>
                <button class="modal-close" onclick="handleCloseAddModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="expense-amount">–°—É–º–º–∞ (PLN) *</label>
                    <input type="number" id="expense-amount" step="0.01" min="0.01" required placeholder="0.00">
                </div>
                <div class="form-group">
                    <label for="expense-comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                    <textarea id="expense-comment" rows="3" maxlength="5000" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="handleSaveEntry()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn btn-secondary" onclick="handleCloseAddModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- Modal for viewing/editing expense entries list -->
    <div id="expense-list-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3 id="list-entry-title">–†–∞—Å—Ö–æ–¥—ã –∑–∞ –º–µ—Å—è—Ü</h3>
                <button class="modal-close" onclick="handleCloseListModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="expense-list-container">
                    <!-- Entries will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="add-entry-from-list-btn" onclick="handleAddEntryFromList()">–î–æ–±–∞–≤–∏—Ç—å</button>
                <button class="btn btn-secondary" onclick="closeExpenseListModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Modal for viewing payment list (for auto-managed revenue categories) -->
    <div id="payment-list-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 id="payment-list-title">–ü–ª–∞—Ç–µ–∂–∏ –∑–∞ –º–µ—Å—è—Ü</h3>
                <button class="modal-close" onclick="closePaymentListModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="payment-list-loading" class="loading-indicator" style="display: none;" role="status" aria-live="polite">
                    <span class="sr-only">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π...</span>
                    –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π...
                </div>
                <div id="payment-list-container">
                    <!-- Payments will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePaymentListModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Modal for editing expense entry -->
    <div id="edit-expense-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 id="edit-entry-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</h3>
                <button class="modal-close" onclick="handleCloseEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="edit-expense-amount">–°—É–º–º–∞ (PLN) *</label>
                    <input type="number" id="edit-expense-amount" step="0.01" min="0.01" required placeholder="0.00">
                </div>
                <div class="form-group">
                    <label for="edit-expense-comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                    <textarea id="edit-expense-comment" rows="3" maxlength="5000" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="handleSaveEditedEntry()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn btn-secondary" onclick="handleCloseEditModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- Duplicates Modal -->
    <div id="duplicates-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 id="duplicates-modal-title">–î—É–±–ª–∏ –ø–ª–∞—Ç–µ–∂–µ–π</h3>
                <button class="modal-close" onclick="closeDuplicatesModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="duplicates-container">
                    <div class="loading-indicator">–ó–∞–≥—Ä—É–∑–∫–∞ –¥—É–±–ª–µ–π...</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDuplicatesModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <script src="/pnl-report-script.js"></script>
</body>
</html>
