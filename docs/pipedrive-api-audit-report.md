# –û—Ç—á–µ—Ç –ø–æ —Ä–µ–≤–∏–∑–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Pipedrive API

**–î–∞—Ç–∞:** 2025-11-18  
**–¶–µ–ª—å:** –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Pipedrive API –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –¥—É–±–ª–µ–π –∏ –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

---

## üìä –°–≤–æ–¥–∫–∞

### –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Pipedrive API

| –¢–∏–ø –∑–∞–ø—Ä–æ—Å–∞ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ | –ß–∞—Å—Ç–æ—Ç–∞ |
|------------|-------------------|---------|
| `getDeals()` | 4 –º–µ—Å—Ç–∞ | –ö–∞–∂–¥—ã–π —á–∞—Å + –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç |
| `getDeal()` | 4 –º–µ—Å—Ç–∞ | –ü–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é |
| `getDealWithRelatedData()` | 5 –º–µ—Å—Ç | –ü–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é |
| `getDealNotes()` | 1 –º–µ—Å—Ç–æ | –ü–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é |
| `getUserInfo()` | 1 –º–µ—Å—Ç–æ | –ü—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ |

---

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

### 1. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `getDeals()` –∑–∞–ø—Ä–æ—Å–æ–≤

#### –ü—Ä–æ–±–ª–µ–º–∞: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

**–ú–µ—Å—Ç–∞ –≤—ã–∑–æ–≤–∞:**

1. **`src/services/invoiceProcessing.js:1024`** - `getPendingInvoiceDeals()`
   ```javascript
   getDeals({ limit: 500, start: 0, status: 'open' })
   ```
   - **–ß–∞—Å—Ç–æ—Ç–∞:** –ö–∞–∂–¥—ã–π —á–∞—Å (—á–µ—Ä–µ–∑ scheduler)
   - **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–≤–æ–π—Å–æ–≤

2. **`src/services/invoiceProcessing.js:345`** - `getDealsMarkedForDeletion()`
   ```javascript
   getDeals({ limit: 500, start: 0, status: 'open' })
   ```
   - **–ß–∞—Å—Ç–æ—Ç–∞:** –ö–∞–∂–¥—ã–π —á–∞—Å (—á–µ—Ä–µ–∑ scheduler)
   - **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
   - ‚ö†Ô∏è **–î–£–ë–õ–¨:** –¢–µ –∂–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —á—Ç–æ –∏ –≤ `getPendingInvoiceDeals()`

3. **`src/services/stripe/processor.js:1593`** - `processPendingPayments()`
   ```javascript
   getDeals({ limit: 500, start: 0, status: 'open' })
   ```
   - **–ß–∞—Å—Ç–æ—Ç–∞:** –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç (—á–µ—Ä–µ–∑ scheduler)
   - **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Stripe –ø–ª–∞—Ç–µ–∂–µ–π
   - ‚ö†Ô∏è **–î–£–ë–õ–¨:** –¢–µ –∂–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —á—Ç–æ –∏ –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –¥–≤—É—Ö

4. **`src/services/stripe/processor.js:2374`** - `processLostDealRefunds()`
   ```javascript
   getDeals({ limit: 500, start: 0, status: 'lost' })
   ```
   - **–ß–∞—Å—Ç–æ—Ç–∞:** –ö–∞–∂–¥—ã–π —á–∞—Å (—á–µ—Ä–µ–∑ scheduler)
   - **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫ –¥–ª—è —Ä–µ—Ñ–∞–Ω–¥–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –í –æ–¥–Ω–æ–º —Ü–∏–∫–ª–µ scheduler –¥–µ–ª–∞–µ—Ç—Å—è **3 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞** `getDeals({ limit: 500, start: 0, status: 'open' })`
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–∞–µ—Ç –¥–æ 500 —Å–¥–µ–ª–æ–∫, –Ω–æ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –∏—Ö –ø–æ-—Ä–∞–∑–Ω–æ–º—É –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ **3x —Ä–∞—Å—Ö–æ–¥—É API –ª–∏–º–∏—Ç–∞** –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤—Å–µ —Ç—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞ –≤ –æ–¥–∏–Ω
- –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ —Å–¥–µ–ª–∫–∏ –æ–¥–∏–Ω —Ä–∞–∑
- –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –ø–æ —Ä–∞–∑–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º

---

### 2. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã `getDeal()` –¥–ª—è –æ–¥–Ω–æ–π —Å–¥–µ–ª–∫–∏

#### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–∞–Ω–Ω—ã—Ö –æ–¥–Ω–æ–π —Å–¥–µ–ª–∫–∏

**–ú–µ—Å—Ç–∞ –≤—ã–∑–æ–≤–∞:**

1. **`src/services/stripe/processor.js:791`** - –ü—Ä–æ–≤–µ—Ä–∫–∞ `close_date` –¥–ª—è –ª–æ–≥–∏–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π
   ```javascript
   getDeal(dealId) // –ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ close_date
   ```

2. **`src/services/stripe/processor.js:861`** - –ü—Ä–æ–≤–µ—Ä–∫–∞ `stage_id` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏
   ```javascript
   getDeal(dealId) // –ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ stage_id
   ```

3. **`src/services/stripe/processor.js:933`** - –ó–∞–≥—Ä—É–∑–∫–∞ —Å–¥–µ–ª–∫–∏ –¥–ª—è –∫–µ—à–∞
   ```javascript
   getDeal(dealId) // –ü–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è –∫–µ—à–∞
   ```

4. **`src/services/stripe/processor.js:2400`** - –ü—Ä–æ–≤–µ—Ä–∫–∞ `lost_reason` –¥–ª—è —Ä–µ—Ñ–∞–Ω–¥–æ–≤
   ```javascript
   getDeal(deal.id) // –ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ lost_reason
   ```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í –æ–¥–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–¥–µ–ª–∞–Ω–æ **2-3 –∑–∞–ø—Ä–æ—Å–∞** –¥–ª—è –æ–¥–Ω–æ–π —Å–¥–µ–ª–∫–∏
- –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏
- –ù–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `getDealWithRelatedData()` –æ–¥–∏–Ω —Ä–∞–∑ –≤ –Ω–∞—á–∞–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
- –î–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–æ—Ü–µ—Å—Å–∞

---

### 3. –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã–∑–æ–≤—ã `getDealWithRelatedData()`

#### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å–¥–µ–ª–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑

**–ú–µ—Å—Ç–∞ –≤—ã–∑–æ–≤–∞:**

1. **`src/services/invoiceProcessing.js:1110`** - `processDealInvoice()`
   ```javascript
   getDealWithRelatedData(deal.id) // –ï—Å–ª–∏ person/organization –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω—ã
   ```

2. **`src/services/stripe/processor.js:1881`** - `createCheckoutSession()`
   ```javascript
   getDealWithRelatedData(dealId) // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏
   ```

3. **`src/services/stripe/processor.js:3069`** - `sendRefundNotification()`
   ```javascript
   getDealWithRelatedData(dealId) // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è SendPulse
   ```

4. **`src/services/stripe/processor.js:3227`** - `sendPaymentNotification()`
   ```javascript
   getDealWithRelatedData(dealId) // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è SendPulse
   ```

5. **`src/services/invoiceProcessing.js:3481`** - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–¥–µ–ª–∫–∏
   ```javascript
   getDealWithRelatedData(dealId) // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   ```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –î–ª—è –æ–¥–Ω–æ–π —Å–¥–µ–ª–∫–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–¥–µ–ª–∞–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ `getDealWithRelatedData()`
- –û—Å–æ–±–µ–Ω–Ω–æ –≤ `stripe/processor.js` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–¥–µ–ª–∫–∏ –º–µ–∂–¥—É –º–µ—Ç–æ–¥–∞–º–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–µ—à –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Ä–≤–∏—Å–∞
- –ò–∑–±–µ–≥–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞

---

### 4. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

#### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –ï—Å—Ç—å –ø—Ä–æ—Å—Ç–æ–π –∫–µ—à –≤ `stripe/processor.js` (—Å—Ç—Ä–æ–∫–∞ 933), –Ω–æ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞
- –ù–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ `getDeals()`
- –ù–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ `getDeal()`
- –ù–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ `getDealWithRelatedData()`

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å TTL (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5-10 –º–∏–Ω—É—Ç)
- –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã `getDeals()` –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã `getDeal()` –∏ `getDealWithRelatedData()`

---

## üìà –û—Ü–µ–Ω–∫–∞ —Ä–∞—Å—Ö–æ–¥–∞ —Ç–æ–∫–µ–Ω–æ–≤ Pipedrive API

> üìò **–í–∞–∂–Ω–æ:** Pipedrive –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **token-based rate limiting**. –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –∏–∑ –¥–Ω–µ–≤–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞.
> 
> **–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ (–ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Pipedrive):**
> - `Get list of entities` (getDeals): **20 —Ç–æ–∫–µ–Ω–æ–≤**
> - `Get single entity` (getDeal): **2 —Ç–æ–∫–µ–Ω–∞**
> - `Update single entity`: **10 —Ç–æ–∫–µ–Ω–æ–≤**
> - `Search for entities`: **40 —Ç–æ–∫–µ–Ω–æ–≤**

### –¢–µ–∫—É—â–∏–π —Ä–∞—Å—Ö–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤ (–≤ –¥–µ–Ω—å):

| –ü—Ä–æ—Ü–µ—Å—Å | –ß–∞—Å—Ç–æ—Ç–∞ | –ó–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ —Ü–∏–∫–ª | –¢–æ–∫–µ–Ω–æ–≤ –∑–∞ —Ü–∏–∫–ª | –¢–æ–∫–µ–Ω–æ–≤ –≤ –¥–µ–Ω—å |
|---------|---------|------------------|-----------------|----------------|
| Invoice Processing | –ö–∞–∂–¥—ã–π —á–∞—Å | 2x `getDeals(500)` = 40 —Ç–æ–∫–µ–Ω–æ–≤ | 40 | 960 |
| Stripe Processing | –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç | 1x `getDeals(500)` = 20 —Ç–æ–∫–µ–Ω–æ–≤ | 20 | 1,920 |
| Lost Deals Refunds | –ö–∞–∂–¥—ã–π —á–∞—Å | 1x `getDeals(500)` = 20 —Ç–æ–∫–µ–Ω–æ–≤ | 20 | 480 |
| **–ò–¢–û–ì–û getDeals()** | | | | **3,360 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å** |
| **getDeal()** (–ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã) | ~50-100 —Ä–∞–∑ | 1x `getDeal()` = 2 —Ç–æ–∫–µ–Ω–∞ | 2 | **100-200 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å** |
| **getDealWithRelatedData()** | ~20-30 —Ä–∞–∑ | –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∑–∞–ø—Ä–æ—Å ‚âà 10 —Ç–æ–∫–µ–Ω–æ–≤ | 10 | **200-300 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å** |
| **Update/Delete –æ–ø–µ—Ä–∞—Ü–∏–∏** | ~10-20 —Ä–∞–∑ | 10-6 —Ç–æ–∫–µ–Ω–æ–≤ | 8-10 | **80-200 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å** |
| **–û–ë–©–ò–ô –†–ê–°–•–û–î –¢–û–ö–ï–ù–û–í** | | | | **~3,740-4,060 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å** |

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û:** –ü—Ä–∏ –±—é–¥–∂–µ—Ç–µ 60,000 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å —Ä–∞—Å—Ö–æ–¥—É–µ—Ç—Å—è **~6-7% –±—é–¥–∂–µ—Ç–∞**, –Ω–æ –ø—Ä–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ —ç—Ç–æ –º–æ–∂–µ—Ç –≤—ã—Ä–∞—Å—Ç–∏ –¥–æ **~7,500-8,000 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å** (12-13% –±—é–¥–∂–µ—Ç–∞).

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–æ—Ü–µ–Ω–∫–∞):

| –ü—Ä–æ—Ü–µ—Å—Å | –ß–∞—Å—Ç–æ—Ç–∞ | –ó–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ —Ü–∏–∫–ª | –¢–æ–∫–µ–Ω–æ–≤ –∑–∞ —Ü–∏–∫–ª | –¢–æ–∫–µ–Ω–æ–≤ –≤ –¥–µ–Ω—å |
|---------|---------|------------------|-----------------|----------------|
| –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å | –ö–∞–∂–¥—ã–π —á–∞—Å | 1x `getDeals(500)` = 20 —Ç–æ–∫–µ–Ω–æ–≤ | 20 | 480 |
| Stripe Processing | –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–µ—à (0 —Ç–æ–∫–µ–Ω–æ–≤) | 0 | 0 |
| Lost Deals Refunds | –ö–∞–∂–¥—ã–π —á–∞—Å | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–µ—à (0 —Ç–æ–∫–µ–Ω–æ–≤) | 0 | 0 |
| **–ò–¢–û–ì–û getDeals()** | | | | **480 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å** |
| **getDeal()** (—Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º) | ~10-20 —Ä–∞–∑ | 1x `getDeal()` = 2 —Ç–æ–∫–µ–Ω–∞ | 2 | **20-40 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å** |
| **getDealWithRelatedData()** (—Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º) | ~5-10 —Ä–∞–∑ | ‚âà 10 —Ç–æ–∫–µ–Ω–æ–≤ | 10 | **50-100 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å** |
| **Update/Delete –æ–ø–µ—Ä–∞—Ü–∏–∏** | ~10-20 —Ä–∞–∑ | 10-6 —Ç–æ–∫–µ–Ω–æ–≤ | 8-10 | **80-200 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å** |
| **–û–ë–©–ò–ô –†–ê–°–•–û–î –¢–û–ö–ï–ù–û–í** | | | | **~630-820 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å** |

**–≠–∫–æ–Ω–æ–º–∏—è: ~83-85% —Ç–æ–∫–µ–Ω–æ–≤** (—Å ~3,740-4,060 –¥–æ ~630-820 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å)

**–≠–∫–æ–Ω–æ–º–∏—è –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö —á–∏—Å–ª–∞—Ö: ~3,100-3,200 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å**

---

## ‚ö†Ô∏è –ê–Ω–∞–ª–∏–∑ —Ä–∏—Å–∫–æ–≤ –ø—Ä–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:

1. **–†–∞–∑–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã —Å–¥–µ–ª–æ–∫:**
   - `getPendingInvoiceDeals()` –∏ `getDealsMarkedForDeletion()` –∏—Å–ø–æ–ª—å–∑—É—é—Ç `status: 'open'`
   - `processPendingPayments()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `status: 'open'`
   - `processLostDealRefunds()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `status: 'lost'` ‚ö†Ô∏è **–†–ê–ó–ù–´–ô –°–¢–ê–¢–£–°**
   - **–í—ã–≤–æ–¥:** `processLostDealRefunds()` **–ù–ï–õ–¨–ó–Ø** –æ–±—ä–µ–¥–∏–Ω—è—Ç—å —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏

2. **–†–∞–∑–Ω—ã–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—É—Å–∫–∞:**
   - Invoice processing: **–∫–∞–∂–¥—ã–π —á–∞—Å**
   - Stripe processing: **–∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç** (–≤ 4 —Ä–∞–∑–∞ —á–∞—â–µ)
   - Lost deals refunds: **–∫–∞–∂–¥—ã–π —á–∞—Å**
   - **–†–∏—Å–∫:** –ï—Å–ª–∏ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –≤ scheduler, Stripe processing –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ (–¥–æ 1 —á–∞—Å–∞)

3. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
   - –°–¥–µ–ª–∫–∞ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å `open` –Ω–∞ `lost` –º–µ–∂–¥—É –ø–æ–ª—É—á–µ–Ω–∏–µ–º —Å–ø–∏—Å–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
   - –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å –æ–¥–∏–Ω —Å–ø–∏—Å–æ–∫ –≤—Å–µ–º –ø—Ä–æ—Ü–µ—Å—Å–∞–º, `processLostDealRefunds()` –Ω–µ —É–≤–∏–¥–∏—Ç –Ω–æ–≤—ã–µ `lost` —Å–¥–µ–ª–∫–∏
   - **–†–∏—Å–∫:** –ü—Ä–æ–ø—É—Å–∫ —Ä–µ—Ñ–∞–Ω–¥–æ–≤ –¥–ª—è –Ω–µ–¥–∞–≤–Ω–æ –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫

4. **–†–∞–∑–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è:**
   - `getPendingInvoiceDeals()`: —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ `INVOICE_TYPE_FIELD_KEY` —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏
   - `getDealsMarkedForDeletion()`: —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ `DELETE_TRIGGER_FIELD_KEY`
   - `processPendingPayments()`: —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ `invoice_type = "75"` (Stripe trigger)
   - **–í—ã–≤–æ–¥:** –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ, –Ω–æ –ª–æ–≥–∏–∫–∞ —Ä–∞–∑–Ω–∞—è

### ‚ö†Ô∏è –†–∏—Å–∫–∏ –ø—Ä–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤:

1. **–£—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:**
   - –ï—Å–ª–∏ –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ–¥–∏–Ω —Ä–∞–∑ –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –≤—Å–µ–º –ø—Ä–æ—Ü–µ—Å—Å–∞–º, –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç —É—Å—Ç–∞—Ä–µ—Ç—å –º–µ–∂–¥—É –ø–æ–ª—É—á–µ–Ω–∏–µ–º –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
   - –û—Å–æ–±–µ–Ω–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è Stripe processing (–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç)

2. **–ü—Ä–æ–ø—É—Å–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
   - –ï—Å–ª–∏ —Å–¥–µ–ª–∫–∞ –∏–∑–º–µ–Ω–∏—Ç —Å—Ç–∞—Ç—É—Å —Å `open` –Ω–∞ `lost` –º–µ–∂–¥—É –ø–æ–ª—É—á–µ–Ω–∏–µ–º —Å–ø–∏—Å–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π, `processLostDealRefunds()` –Ω–µ —É–≤–∏–¥–∏—Ç –µ—ë
   - –ï—Å–ª–∏ —Å–¥–µ–ª–∫–∞ –∏–∑–º–µ–Ω–∏—Ç `invoice_type` –º–µ–∂–¥—É –ø–æ–ª—É—á–µ–Ω–∏–µ–º –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π, –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω–∞

3. **–ù–∞—Ä—É—à–µ–Ω–∏–µ –∏–∑–æ–ª—è—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:**
   - –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–∑–æ–ª–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
   - –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–æ–∑–¥–∞—Å—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏
   - –û—à–∏–±–∫–∞ –≤ –æ–¥–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ –º–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –¥—Ä—É–≥–∏–µ

## üéØ –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–î–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ `getDeals()` —Å –∫–æ—Ä–æ—Ç–∫–∏–º TTL**
   - –ö–µ—à –Ω–∞ **2-3 –º–∏–Ω—É—Ç—ã** (–º–µ–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ polling)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
   - **–≠–∫–æ–Ω–æ–º–∏—è:** ~24-48 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å
   - **–†–∏—Å–∫:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (TTL –º–µ–Ω—å—à–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ polling)

2. **–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ scheduler (hourly)**
   - –í `runCycle()` (–∫–∞–∂–¥—ã–π —á–∞—Å) –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ–¥–∏–Ω —Ä–∞–∑
   - –ü–µ—Ä–µ–¥–∞—Ç—å –≤ `processPendingInvoices()` –∏ `getDealsMarkedForDeletion()`
   - **–ù–ï –æ–±—ä–µ–¥–∏–Ω—è—Ç—å** —Å `processPendingPayments()` (–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç)
   - **–≠–∫–æ–Ω–æ–º–∏—è:** ~24 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å
   - **–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π (–≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)

3. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ `getDeal()` –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞**
   - –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–æ–ª–Ω—É—é —Å–¥–µ–ª–∫—É –º–µ–∂–¥—É –º–µ—Ç–æ–¥–∞–º–∏ –≤–º–µ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `getDealWithRelatedData()` –æ–¥–∏–Ω —Ä–∞–∑ –≤ –Ω–∞—á–∞–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
   - **–≠–∫–æ–Ω–æ–º–∏—è:** ~20-30 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å
   - **–†–∏—Å–∫:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (–≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞)

### ‚ö†Ô∏è –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –¢—Ä–µ–±—É–µ—Ç –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏

4. **–î–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ `getDealWithRelatedData()` —Å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π**
   - –ö–µ—à –Ω–∞ **5 –º–∏–Ω—É—Ç**
   - –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–¥–µ–ª–∫–∏ —á–µ—Ä–µ–∑ webhook
   - **–≠–∫–æ–Ω–æ–º–∏—è:** ~10-20 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å
   - **–†–∏—Å–∫:** –°—Ä–µ–¥–Ω–∏–π (–Ω—É–∂–Ω–∞ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞)

5. **–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è Stripe processing —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º**
   - –í `runStripePaymentsCycle()` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–µ—à –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
   - –ï—Å–ª–∏ –∫–µ—à —Å–≤–µ–∂–∏–π (< 5 –º–∏–Ω—É—Ç), –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ
   - **–≠–∫–æ–Ω–æ–º–∏—è:** ~48 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å
   - **–†–∏—Å–∫:** –°—Ä–µ–¥–Ω–∏–π (–Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö)

### üö´ –ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è (—Å–ª–∏—à–∫–æ–º —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–æ)

6. ~~**–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã `getDeals()` –≤ –æ–¥–∏–Ω**~~
   - ‚ùå **–†–∏—Å–∫:** –†–∞–∑–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã (`open` vs `lost`)
   - ‚ùå **–†–∏—Å–∫:** –†–∞–∑–Ω—ã–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—É—Å–∫–∞ (15 –º–∏–Ω—É—Ç vs 1 —á–∞—Å)
   - ‚ùå **–†–∏—Å–∫:** –£—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –ø–æ–ª—É—á–µ–Ω–∏–µ–º –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π

7. ~~**–£–º–µ–Ω—å—à–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É Stripe polling**~~
   - ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–Ω–æ —Å–∫–∞–∑–∞–ª "–Ω–µ—Ç –Ω–µ –Ω–∞–¥–æ –æ—Ç–∫–ª—é—á–∞—Ç—å"
   - ‚úÖ **–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Pipedrive webhooks –¥–ª—è —Ç–æ—á–µ—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

8. **–í–Ω–µ–¥—Ä–∏—Ç—å Pipedrive webhooks –¥–ª—è —Ç–æ—á–µ—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π** ‚≠ê **–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø**
   - Webhook –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ `invoice_type` ‚Üí –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å–¥–µ–ª–∫—É
   - Webhook –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ `lost` ‚Üí –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–µ—Ñ–∞–Ω–¥
   - Webhook –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Checkout Session ‚Üí –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–ª–∞—Ç–µ–∂
   - **–≠–∫–æ–Ω–æ–º–∏—è:** ~90% –∑–∞–ø—Ä–æ—Å–æ–≤ `getDeals()` (—Å ~3,360 –¥–æ ~336 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å)
   - **–†–∏—Å–∫:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (webhooks –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã, —á–µ–º polling)
   - **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
     - –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
     - –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ polling –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤
     - –¢–æ—á–µ—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ –º–∞—Å—Å–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
     - –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ Pipedrive API

9. **–î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤**
   - –ï—Å–ª–∏ —Å–¥–µ–ª–æ–∫ –±–æ–ª—å—à–µ 500, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é
   - –ó–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   - **–≠–∫–æ–Ω–æ–º–∏—è:** –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–¥–µ–ª–æ–∫

---

## üîß –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ PipedriveClient (–±–µ–∑–æ–ø–∞—Å–Ω–æ)

```javascript
// src/services/pipedrive.js
class PipedriveClient {
  constructor() {
    this.dealsCache = new Map(); // –ö–µ—à –¥–ª—è getDeals()
    this.dealCache = new Map(); // –ö–µ—à –¥–ª—è getDeal()
    this.dealsCacheTTL = 2 * 60 * 1000; // 2 –º–∏–Ω—É—Ç—ã (–º–µ–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞)
    this.dealCacheTTL = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç
  }
  
  async getDeals(params, useCache = true) {
    // –ö–µ—à —Ç–æ–ª—å–∫–æ –¥–ª—è status: 'open' –∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    const cacheKey = `deals_${params.status}_${params.limit}_${params.start}`;
    
    if (useCache && params.status === 'open') {
      const cached = this.dealsCache.get(cacheKey);
      if (cached && Date.now() - cached.timestamp < this.dealsCacheTTL) {
        return cached.data;
      }
    }
    
    const result = await this._getDeals(params);
    if (result.success && params.status === 'open') {
      this.dealsCache.set(cacheKey, {
        data: result,
        timestamp: Date.now()
      });
    }
    return result;
  }
  
  async getDeal(dealId, useCache = true) {
    const cacheKey = `deal_${dealId}`;
    if (useCache && this.dealCache.has(cacheKey)) {
      const cached = this.dealCache.get(cacheKey);
      if (Date.now() - cached.timestamp < this.dealCacheTTL) {
        return cached.data;
      }
    }
    
    const result = await this._getDeal(dealId);
    if (result.success) {
      this.dealCache.set(cacheKey, {
        data: result,
        timestamp: Date.now()
      });
    }
    return result;
  }
  
  // –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–¥–µ–ª–∫–∏ (–¥–ª—è webhooks)
  invalidateDealCache(dealId) {
    this.dealCache.delete(`deal_${dealId}`);
    // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫–µ—à —Å–ø–∏—Å–∫–æ–≤, —Ç–∞–∫ –∫–∞–∫ —Å–¥–µ–ª–∫–∞ –º–æ–≥–ª–∞ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è
    this.dealsCache.clear();
  }
}
```

### 2. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Ç–æ–ª—å–∫–æ –≤ hourly —Ü–∏–∫–ª–µ (–±–µ–∑–æ–ø–∞—Å–Ω–æ)

```javascript
// src/services/scheduler.js
async runCycle({ trigger = 'manual', retryAttempt = 0 }) {
  // ... existing code ...
  
  try {
    // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ —Å–¥–µ–ª–∫–∏ –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è hourly —Ü–∏–∫–ª–∞
    // –ù–ï –æ–±—ä–µ–¥–∏–Ω—è—Ç—å —Å Stripe processing (–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç)
    const allOpenDealsResult = await this.invoiceProcessing.pipedriveClient.getDeals({
      limit: 500,
      start: 0,
      status: 'open'
    }, true); // useCache = true
    
    if (allOpenDealsResult.success) {
      // –ü–µ—Ä–µ–¥–∞—Ç—å –≤ invoice processing
      invoiceResult = await this.invoiceProcessing.processPendingInvoices({
        deals: allOpenDealsResult.deals
      });
      
      // –ü–µ—Ä–µ–¥–∞—Ç—å –≤ deletion processing
      const deletionResult = await this.invoiceProcessing.processDeletionRequests({
        deals: allOpenDealsResult.deals
      });
    } else {
      // Fallback: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã
      invoiceResult = await this.invoiceProcessing.processPendingInvoices();
    }
    
    // Stripe processing –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º (–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç)
    stripeResult = await this.stripeProcessor.processPendingPayments({
      trigger,
      runId
    });
    
    // ... rest of the code ...
  }
}
```

### 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ Pipedrive webhooks (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```javascript
// src/routes/pipedriveWebhook.js (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
router.post('/webhooks/pipedrive', express.raw({ type: 'application/json' }), async (req, res) => {
  try {
    const event = JSON.parse(req.body.toString());
    
    switch (event.event) {
      case 'deal.updated':
        // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å–¥–µ–ª–∫—É —Ç–æ—á–µ—á–Ω–æ
        const dealId = event.current.id;
        const invoiceType = event.current[INVOICE_TYPE_FIELD_KEY];
        
        if (invoiceType) {
          // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–¥–µ–ª–∫–∏
          await invoiceProcessing.processDealInvoice(dealId);
        }
        break;
        
      case 'deal.status_changed':
        if (event.current.status === 'lost') {
          // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–µ—Ñ–∞–Ω–¥ –¥–ª—è –ø–æ—Ç–µ—Ä—è–Ω–Ω–æ–π —Å–¥–µ–ª–∫–∏
          await stripeProcessor.processLostDealRefund(dealId);
        }
        break;
    }
    
    res.json({ received: true });
  } catch (error) {
    logger.error('Pipedrive webhook error:', error);
    res.status(500).json({ error: error.message });
  }
});
```

---

## üìù –ò—Ç–æ–≥–æ–≤—ã–µ –≤—ã–≤–æ–¥—ã

### –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. ‚úÖ **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ `getDeals()`** - 3 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ –≤ –æ–¥–Ω–æ–º —Ü–∏–∫–ª–µ
   - **–°—Ç–æ–∏–º–æ—Å—Ç—å:** 3 √ó 20 —Ç–æ–∫–µ–Ω–æ–≤ = **60 —Ç–æ–∫–µ–Ω–æ–≤/—Ü–∏–∫–ª** (–≤–º–µ—Å—Ç–æ 20)
   - **–ü–æ—Ç–µ—Ä–∏:** **40 —Ç–æ–∫–µ–Ω–æ–≤/—á–∞—Å** = **960 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å** —Ç–æ–ª—å–∫–æ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–∏

2. ‚úÖ **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã `getDeal()`** - –¥–æ 3 –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –æ–¥–Ω–æ–π —Å–¥–µ–ª–∫–∏
   - **–°—Ç–æ–∏–º–æ—Å—Ç—å:** 3 √ó 2 —Ç–æ–∫–µ–Ω–∞ = **6 —Ç–æ–∫–µ–Ω–æ–≤** (–≤–º–µ—Å—Ç–æ 2)
   - **–ü–æ—Ç–µ—Ä–∏:** ~100-200 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å

3. ‚úÖ **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã `getDealWithRelatedData()`** - –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –¥–ª—è –æ–¥–Ω–æ–π —Å–¥–µ–ª–∫–∏
   - **–°—Ç–æ–∏–º–æ—Å—Ç—å:** –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∑–∞–ø—Ä–æ—Å ‚âà 10 —Ç–æ–∫–µ–Ω–æ–≤ √ó –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤
   - **–ü–æ—Ç–µ—Ä–∏:** ~200-300 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å

4. ‚úÖ **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è** - –Ω–µ—Ç –∫–µ—à–∞ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
   - **Stripe polling –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç:** 20 —Ç–æ–∫–µ–Ω–æ–≤ √ó 96 = **1,920 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å**
   - **–° –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º:** –ú–æ–∂–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –¥–æ **0 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å**

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤:

- **–¢–µ–∫—É—â–∏–π —Ä–∞—Å—Ö–æ–¥:** ~3,740-4,060 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å (**~6-7% –±—é–¥–∂–µ—Ç–∞ 60k**)
- **–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:** ~630-820 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å (**~1-1.4% –±—é–¥–∂–µ—Ç–∞ 60k**)
- **–≠–∫–æ–Ω–æ–º–∏—è:** **~3,100-3,200 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å** (**~83-85% —ç–∫–æ–Ω–æ–º–∏–∏**)

### –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã:

–ü—Ä–∏ —Ç–µ–∫—É—â–µ–º —Ä–∞—Å—Ö–æ–¥–µ **~4,000 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å** –∏ –±—é–¥–∂–µ—Ç–µ **60,000 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å**:
- ‚úÖ –ï—Å—Ç—å –∑–∞–ø–∞—Å, –Ω–æ –ø—Ä–∏ —Ä–æ—Å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–¥–µ–ª–æ–∫ –∏–ª–∏ —á–∞—Å—Ç–æ—Ç—ã polling –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –ø—Ä–æ–±–ª–µ–º–∞
- ‚ö†Ô∏è –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Ç—Ä–∞—Ç–∏—Ç **~1,000 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å –≤–ø—É—Å—Ç—É—é**
- ‚ö†Ô∏è –ë–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –∏—Å—á–µ—Ä–ø–∞—Ç—å –±—é–¥–∂–µ—Ç

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:

#### –§–∞–∑–∞ 1: –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Å—Ä–∞–∑—É)
1. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ `getDeals()` —Å TTL 2-3 –º–∏–Ω—É—Ç—ã**
2. ‚úÖ **–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–º–∫–∞—Ö hourly —Ü–∏–∫–ª–∞** (`runCycle()`)
3. ‚úÖ **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ `getDeal()` –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞**

#### –§–∞–∑–∞ 2: –í–Ω–µ–¥—Ä–µ–Ω–∏–µ Pipedrive webhooks ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û**
4. ‚úÖ **–ù–∞—Å—Ç—Ä–æ–µ–Ω—ã Pipedrive webhooks –¥–ª—è —Å–æ–±—ã—Ç–∏–π:**
   - `deal.updated` (–∏–∑–º–µ–Ω–µ–Ω–∏–µ `invoice_type`) ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–≤–æ–π—Å–æ–≤ –∏ Stripe Checkout Sessions
   - `deal.status_changed` (–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ `lost` —Å reason "Refund") ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ—Ñ–∞–Ω–¥–æ–≤
   - Workflow automation —Ñ–æ—Ä–º–∞—Ç ‚Üí –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ Pipedrive –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–π
5. ‚úÖ **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è webhook —Å–æ–±—ã—Ç–∏—è —Ç–æ—á–µ—á–Ω–æ:**
   - –í–º–µ—Å—Ç–æ polling –≤—Å–µ–π –±–∞–∑—ã ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Å–¥–µ–ª–∫–∞
   - Polling —Å–Ω–∏–∂–µ–Ω –¥–æ fallback —Ä–µ–∂–∏–º–∞ (—Ä–∞–∑ –≤ —á–∞—Å –¥–ª—è –∏–Ω–≤–æ–π—Å–æ–≤, Stripe –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ webhooks)
6. ‚úÖ **Polling –æ—Å—Ç–∞–≤–ª–µ–Ω –∫–∞–∫ fallback:**
   - –ù–∞ —Å–ª—É—á–∞–π –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö webhook —Å–æ–±—ã—Ç–∏–π
   - –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
   - –†–µ—Ñ–∞–Ω–¥—ã (`processLostDealRefunds`) —É–¥–∞–ª–µ–Ω—ã –∏–∑ polling, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ webhooks

#### –§–∞–∑–∞ 3: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–ø–æ—Å–ª–µ webhooks)
7. **–î–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ `getDealWithRelatedData()` —Å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π**
8. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç–æ—Ç—É fallback polling** (–ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è webhooks)

---

## üìã –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã

### –í–æ–ø—Ä–æ—Å: "–¢—ã —Ñ–∏–ª—å—Ç—Ä—É–µ—à—å –Ω–∞–≤–µ—Ä–Ω–æ–µ –≤—Å–µ —Å–¥–µ–ª–∫–∏?"

**–û—Ç–≤–µ—Ç:** –î–∞, —Ç–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –≤—Å–µ —Å–¥–µ–ª–∫–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è:

1. **`getPendingInvoiceDeals()`** –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ `status: 'open'` —Å–¥–µ–ª–∫–∏ (–¥–æ 500), –∑–∞—Ç–µ–º —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç:
   - –ü–æ –Ω–∞–ª–∏—á–∏—é `INVOICE_TYPE_FIELD_KEY`
   - –ü–æ –≤–∞–ª–∏–¥–Ω—ã–º —Ç–∏–ø–∞–º –∏–Ω–≤–æ–π—Å–æ–≤ (–∏—Å–∫–ª—é—á–∞—è `DELETE_TRIGGER_VALUES`)

2. **`getDealsMarkedForDeletion()`** –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ `status: 'open'` —Å–¥–µ–ª–∫–∏ (–¥–æ 500), –∑–∞—Ç–µ–º —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç:
   - –ü–æ –Ω–∞–ª–∏—á–∏—é `DELETE_TRIGGER_FIELD_KEY`
   - –ü–æ –∑–Ω–∞—á–µ–Ω–∏—è–º `DELETE_TRIGGER_VALUES`

3. **`processPendingPayments()`** –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ `status: 'open'` —Å–¥–µ–ª–∫–∏ (–¥–æ 500), –∑–∞—Ç–µ–º —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç:
   - –ü–æ `invoice_type = "75"` (Stripe trigger)

4. **`processLostDealRefunds()`** –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ `status: 'lost'` —Å–¥–µ–ª–∫–∏ (–¥–æ 500), –∑–∞—Ç–µ–º —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç:
   - –ü–æ `lost_reason` –∏ –¥—Ä—É–≥–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º –¥–ª—è —Ä–µ—Ñ–∞–Ω–¥–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ —ç—Ç–∏ —Ñ–∏–ª—å—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è **–ø–æ—Å–ª–µ** –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ —Å–¥–µ–ª–æ–∫, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–∞–µ—Ç –¥–æ 500 —Å–¥–µ–ª–æ–∫
- –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∏–∑ –Ω–∏—Ö –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- Pipedrive API –Ω–µ –º–æ–∂–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –∫–∞—Å—Ç–æ–º–Ω—ã–º –ø–æ–ª—è–º (`invoice_type`, `DELETE_TRIGGER_FIELD_KEY`)

**–†–µ—à–µ–Ω–∏–µ —Å webhooks:** 
- Pipedrive –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–±—ã—Ç–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫
- –ù–µ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –≤—Å–µ —Å–¥–µ–ª–∫–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –±—É–¥–µ—Ç —Ç–æ—á–µ—á–Ω–æ–π –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å–¥–µ–ª–æ–∫

---

**–û—Ç—á–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω:** 2025-11-18  
**–û–±–Ω–æ–≤–ª–µ–Ω:** 2025-11-18 (–ø–µ—Ä–µ—Å–º–æ—Ç—Ä —Å —É—á–µ—Ç–æ–º —Ä–∏—Å–∫–æ–≤ –∏ –ø–ª–∞–Ω–æ–≤ –ø–æ webhooks)  
**–û–±–Ω–æ–≤–ª–µ–Ω:** 2025-11-18 (Pipedrive webhooks —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã)  
**–°—Ç–∞—Ç—É—Å:** 
- ‚úÖ –§–∞–∑–∞ 2 (Pipedrive webhooks) - **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û**
- ‚úÖ –†–µ—Ñ–∞–Ω–¥—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ webhooks (—É–¥–∞–ª–µ–Ω—ã –∏–∑ polling)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏—Å—Ç–æ—Ä–∏—è webhook —Å–æ–±—ã—Ç–∏–π –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- ‚è≥ –§–∞–∑–∞ 1 (–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏) - —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ hourly —Ü–∏–∫–ª–µ)

